PREFIX owl: <http://www.w3.org/2002/07/owl>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns>
PREFIX s4bldg: <https://saref.etsi.org/saref4bldg/>
PREFIX s4ener: <https://saref.etsi.org/saref4ener/>
PREFIX ic: <https://interconnectproject.eu/example/>
PREFIX om: <http://www.wurvoc.org/vocabularies/om-1.8/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema>
PREFIX saref: <https://saref.etsi.org/core/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema>

SELECT ?device ?device_type ?property (AVG(?value) AS ?averageValue) ?unit WHERE {
  ?device saref:makesMeasurement ?measurement .
  ?measurement saref:hasValue ?value .
  ?measurement saref:hasTimestamp ?timestamp .
  ?measurement saref:isMeasuredIn ?unit .
  ?measurement saref:relatesToProperty ?property .
  ?property a saref:Temperature .
  ?device ic:hasDeviceType ?device_type .
  FILTER (
    ?device = {{ device }} &&
    ?timestamp >= xsd:dateTime("{{ min_time }}") &&
    ?timestamp <= xsd:dateTime("{{ max_time }}")
  )
} GROUP BY ?device ?device_type ?property ?unit